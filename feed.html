<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Aid Feed</title>

<style>
:root{
  --green-900:#164d27;
  --green-700:#2b6643;
  --green-500:#37a264;
  --bg:#eaf8ef;
  --card:#ffffff;
  --shadow:0 6px 15px rgba(0,0,0,0.08);
  --radius:14px;
  --text:#1b3b27;
}

/* Body */
body{
  margin:0;
  padding:0;
  font-family:Inter, sans-serif;
  background:var(--bg);
}

/* Header */
.header{
  background:var(--green-700);
  padding:16px;
  color:white;
  text-align:center;
  font-size:20px;
  font-weight:800;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
}

.header img {
  width:40px;
  height:40px;
  border-radius:50%;
  object-fit:cover;
}

/* Feed Container */
.feed{
  max-width:650px;
  margin:20px auto;
  padding:10px;
}

/* Post Card */
.post{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  margin-bottom:22px;
  overflow:hidden;
}

/* Post Header */
.post-header{
  display:flex;
  align-items:center;
  padding:14px;
  gap:12px;
}
.user-pic{
  width:45px;
  height:45px;
  border-radius:50%;
  background:#d4ffe6;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  color:var(--green-700);
  font-size:18px;
}
.user-info .name{
  font-weight:700;
  color:var(--green-900);
}
.user-info .time{
  font-size:12px;
  color:#6b6b6b;
}

/* Post Image */
.post-img{
  width:100%;
  height:290px;
  object-fit:cover;
}

/* Post Caption */
.caption{
  padding:14px;
  color:var(--text);
  font-size:15px;
}

/* Bottom Actions */
.actions{
  display:flex;
  justify-content:space-between;
  padding:10px 14px 16px;
  font-size:15px;
  color:var(--green-700);
}
.actions span{
  cursor:pointer;
  font-weight:600;
}
.actions span:hover{
  text-decoration:underline;
}
</style>
</head>

<body>

<div class="header">
  <img src="images/circle-logo.png" alt="Smart Aid Logo">
  Community Feed
</div>

<div class="feed" id="feedContainer"></div>

<script>
// ------------------------------
// AUTOMATIC FEED GENERATOR
// ------------------------------

// üö© CORRECTION: TEMPORARILY ADDING MOCK DATA FOR TESTING
// The original code failed because localStorage was empty. This mock data ensures posts are rendered.
let donations = JSON.parse(localStorage.getItem("sa_history"));

// If localStorage is empty, use this mock data to populate the feed
if (!donations || donations.length === 0) {
  donations = [
    {
      "name": "Alex Johnson",
      "type": "Food",
      "qty": "5 boxes",
      "item": "non-perishable goods",
      "date": "2025-11-20T08:00:00Z" // Recent date
    },
    {
      "name": "Sarah Lee",
      "type": "Clothes",
      "qty": "3 bags",
      "item": "winter jackets",
      "date": "2025-11-18T15:30:00Z" // Older date
    },
    {
      "name": "Michael B.",
      "type": "Money",
      "qty": "$100",
      "item": "cash donation",
      "date": "2025-10-25T10:00:00Z" // Much older date
    }
  ];
}


// Default images based on donation type
// Note: You must ensure these images exist in the same folder as this HTML file
const imageMap = {
  "food": "food_donation1.jpg",
  "clothes": "clothes_donation.jpg",
  "money": "donation_money.jpg",
  "default": "default_donation.jpg"
};

// Generate human-readable time
function timeAgo(date){
  const now = new Date();
  const past = new Date(date);
  const diffInMilliseconds = now - past;
  const diffInHours = Math.floor(diffInMilliseconds / 3600000); // 1000 * 60 * 60

  if(diffInHours <= 1) return "1 hour ago";
  if(diffInHours < 24) return diffInHours + " hours ago";
  if(diffInHours < 48) return "Yesterday";
  
  // Format the date if it's more than 2 days ago
  const options = { year: 'numeric', month: 'short', day: 'numeric' };
  return past.toLocaleDateString(undefined, options);
}

// Render posts
function renderFeed(){
  const feed = document.getElementById("feedContainer");
  feed.innerHTML = "";

  // The original script reverses the order to show newest first, which is standard for a feed.
  // We make a copy before reversing to avoid modifying the original array reference.
  const postsToShow = [...donations].reverse(); 

  postsToShow.forEach(d => {

    let img = imageMap[d.type.toLowerCase()] || imageMap.default;

    let firstLetter = d.name ? d.name[0].toUpperCase() : "U";

    feed.innerHTML += `
      <div class="post">

        <div class="post-header">
          <div class="user-pic">${firstLetter}</div>
          <div class="user-info">
              <div class="name">${d.name || "SmartAid Donor"}</div>
              <div class="time">${timeAgo(d.date)}</div>
          </div>
        </div>

        <img src="${img}" class="post-img">

        <div class="caption">
          Donated <b>${d.qty}</b> of <b>${d.item}</b> ‚ù§Ô∏è  
          Thank you for spreading kindness through Smart Aid!
        </div>

        <div class="actions">
          <span>‚ù§Ô∏è Like</span>
          <span>üí¨ Comment</span>
          <span>‚Üó Share</span>
        </div>

      </div>
    `;
  });
}

renderFeed();
</script>

</body>
</html>